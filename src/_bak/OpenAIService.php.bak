<?php

namespace Drupal\openai_integration;

use GuzzleHttp\Client;

class OpenAIService {

  /**
   * Generates a response from the OpenAI GPT-3.5-Turbo model
   * based on the provided user prompt.
   * 
   * @param string $prompt User provided prompt to send to OpenAI.
   * @return string The content generated by the AI model in response to the prompt.
   */
  public static function generateResponse($prompt) {
    $client = new Client();
    
    // Make the API request to the OpenAI Chat Completions endpoint
    $response = $client->request('POST', 'https://api.openai.com/v1/chat/completions', [
      'headers' => [
        'Authorization' => 'Bearer ' . getenv('OPENAI_API_KEY'),
        'Content-Type' => 'application/json'
      ],
      'json' => [
        'model' => 'gpt-3.5-turbo',
        'messages' => [
          ["role" => "user", "content" => $prompt]
        ]
      ]
    ]);

    // Decode the JSON response
    $body = $response->getBody();
    $data = json_decode($body, true);

    // Extract and return the first choice's message content.
    // This is where the actual AI-generated response is located.
    return $data['choices'][0]['message']['content'];
  }
}
